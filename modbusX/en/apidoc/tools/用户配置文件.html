<!DOCTYPE html>

<html lang="en"  class=" md_page  heading_no_counter ">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="keywords" content="">
    
    
    <meta name="description" content="">
    
    <meta name="generator" content="teedoc">
    <meta name="theme" content="teedoc-plugin-theme-default">
    
        
        <meta name="markdown-generator" content="teedoc-plugin-markdown-parser">
        
        <script>
MathJax = {"loader": {"load": ["output/svg"]}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}, "svg": {"fontCache": "global"}};
</script>
        
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <meta name="html-generator" content="teedoc-plugin-jupyter-notebook-parser">
        
        <script src="/static/js/theme_default/pre_main.js"></script>
        
        <link rel="stylesheet" href="/static/css/theme_default/prism.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/viewer.min.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/dark.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/theme_default/light.css" type="text/css"/>
        
        <script src="/static/js/theme_default/jquery.min.js"></script>
        
        <script src="/static/js/theme_default/split.js"></script>
        
        <link rel="stylesheet" href="/static/css/search/style.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/custom.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/gitalk/gitalk.css" type="text/css"/>
        
        <link rel="stylesheet" href="/static/css/gitalk/custom_gitalk.css" type="text/css"/>
        
    
    
    <title>土星环的图书馆</title>
    
    <script type="text/javascript">js_vars = {}</script>
    <script type="text/javascript">metadata = {"tags": [], "date": false, "update": [], "ts": 0, "author": "", "brief": "", "cover": "", "class": "heading_no_counter", "draft": false}</script>
</head>


<body class="type_doc">
    
    <div id="navbar">
        <div id="navbar_menu">
            <a class="site_title" href="/en/">
                
                    <img class="site_logo" src="/static/logo/yono_light.svg" alt="yono loge">
                
                
                    <h2> wiki</h2>
                
        </a>
            <a id="navbar_menu_btn"></a>
        </div>
        <div id="navbar_items">
            <div>
                <ul id="nav_left">
<li class="sub_items active_parent"><a >API Doc</a><ul><li class="active"><a  href="/modbusX/en/">modbusX</a></li>
</ul>
</li>
</ul>

            </div>
            <div>
                <ul id="nav_right">
<li class=""><a  href="https://www.yono233.cn">Blog</a></li>
<li class="sub_items "><a  >Language: English</a><ul><li class="active"><a  href="/modbusX/en/apidoc/tools/用户配置文件.html">English</a></li>
<li class=""><a  href="/modbusX/zh_hans/apidoc/tools/用户配置文件.html">中文 简体</a></li>
</ul></li>
</ul>

                <ul class="nav_plugins"><li><a id="themes" class="light"></a></li></ul><ul class="nav_plugins"><li><a id="search"><span class="icon"></span><span class="placeholder">Search</span>
                            <div id="search_hints">
                                <span id="search_input_hint">Keywords separated by space</span>
                                <span id="search_loading_hint">Loading, wait please ...</span>
                                <span id="search_download_err_hint">Download error, please check network and refresh again</span>
                                <span id="search_other_docs_result_hint">Result from other docs</span>
                                <span id="search_curr_doc_result_hint">Result from current doc</span>
                            </div></a></li></ul>
            </div>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="sidebar_wrapper">
            <div id="sidebar">
                <div id="sidebar_title">
                    
                </div>
                <ul class="show">
<li class="not_active with_link"><a href="/modbusX/en/index.html"><span class="label">spec</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/overview/特性.html"><span class="label">Library Features</span><span class=""></span></a></li>
<li class="not_active no_link"><a><span class="label">Commonly APIs</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apigengric/MBx_Ticks.html"><span class="label">MBx_Ticks</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apigengric/Addr_Map.html"><span class="label">Address Tables</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">Slave APIs</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apislave/MBx_Slave_RTU_Init.html"><span class="label">MBx_Slave_RTU_Init</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apislave/MBx_Slave_TCP_Init.html"><span class="label">MBx_Slave_TCP_Init</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active no_link"><a><span class="label">Master APIs</span><span class="sub_indicator sub_indicator_collapsed"></span></a><ul class="">
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apimaster/MBx_Master_RTU_Init.html"><span class="label">MBx_Master_RTU_Init</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apimaster/MBx_Master_TCP_Init.html"><span class="label">MBx_Master_TCP_Init</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apimaster/MBx_Master_Member_Add.html"><span class="label">MBx_Master_Member_Add</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apimaster/MBx_Master_Error_Get.html"><span class="label">MBx_Master_Error_Get</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/apidoc/apimaster/Master2Slave.html"><span class="label">Initiating requests to slave</span><span class=""></span></a></li>
</ul>
</li>
<li class="active_parent no_link"><a><span class="label">Utility</span><span class="sub_indicator"></span></a><ul class="show">
<li class="active with_link"><a href="/modbusX/en/apidoc/tools/用户配置文件.html"><span class="label">User Configuration</span><span class=""></span></a></li>
<li class="not_active with_link"><a href="/modbusX/en/apidoc/tools/资源占用测试报告.html"><span class="label">Resource usage test report</span><span class=""></span></a></li>
</ul>
</li>
<li class="not_active  with_link"><a href="https://github.com/stbanana/modbusX" ><span class="label">Project</span><span class=""></span></a></li>
</ul>

            </div>
        </div>
        <div id="article">
            <div id="menu_wrapper">
                <div id="menu">
                </div>
            </div>
            <div id="content_wrapper">
                <div id="content_body">
                    <div id="article_head">
                        <div id="article_title">
                            
                            <h1></h1>
                            
                        </div>
                        <div id="article_tags">
                            <ul>
                            
                            </ul>
                        </div>
                        <div id="article_info">
                        <div id="article_info_left">
                            <span class="article_author">
                                
                            </span>
                            
                        </div>
                        <div id="article_info_right">
                            
                            <div id="source_link">
                                <a href="https://github.com/stbanana/doc-wiki/docs/modbusX/en/apidoc/tools/用户配置文件.md" target="_blank">
                                    Edit this page
                                </a>
                            </div>
                            
                        </div>
                        </div>
                    </div>
                    <div id="article_tools">
                        <span></span>
                        <span id="toc_btn"></span>
                    </div>
                    <div id="update_history">
                        
                    </div>
                    <div id="article_content">
                        
                            <h1 id="%3Cstrong%3EUser-Configuration-File%3C/strong%3E"><strong>User Configuration File</strong></h1>
<h2 id="Key-point">Key point</h2>
<p>The customization and configuration of the protocol stack should be an easy task to control the resource usage of the software package.</p>
<p>In the <code>common/include</code> directory, there is a file named <code>MBx_user_sample.h</code>. Copy this file and rename it to <code>MBx_user.h</code>, and add it to a path that can be included.</p>
<p>In the global compilation <code>define</code>, add <strong>MBX_INCLUDE_USER_DEFINE_FILE</strong>. This way, the library will use the custom definitions from <code>MBx_user.h</code> instead of the defaults.</p>
<p>Since the configuration file complies with <a href="https://open-cmsis-pack.github.io/Open-CMSIS-Pack-Spec/main/html/configWizard.html"  target="_blank">CMSIS Configuration Wizard Annotations</a>，, you can use the <code>vscode</code> plugin or other methods to render the configuration in <code>MBx_user.h</code>, allowing for a more intuitive configuration. The recommended method is to use the <code>Arm CMSIS Solution</code> plugin for <code>vscode</code>.</p>
<p>Once installed, open the <code>MBx_user.h</code> file and click the &quot;Open Preview&quot; icon in the upper right corner to render the configuration file for graphical configuration.</p>
<p><img src="https://cloudflare-imgbed-6qt.pages.dev/file/1733310833976_%E9%85%8D%E7%BD%AE%E6%B8%B2%E6%9F%93%E5%85%A5%E5%8F%A3%E5%9B%BE%E6%A0%87.png" alt="" /></p>
<p><img src="https://cloudflare-imgbed-6qt.pages.dev/file/1733310836815_%E9%85%8D%E7%BD%AE%E6%B8%B2%E6%9F%93.png" alt="" /></p>
<h2 id="Particulars">Particulars</h2>
<h3 id="MBX_SLAVE_ENABLE">MBX_SLAVE_ENABLE</h3>
<p>Default 1</p>
<p>Whether the slave function is open, 1 is open, 0 is cut off the slave function</p>
<h3 id="MBX_MASTER_ENABLE">MBX_MASTER_ENABLE</h3>
<p>默认 1</p>
<p>Whether the master function is open, 1 is open, 0 is cut off the master function</p>
<h3 id="MBX_MODULE_TCP_MASTER_ENABLE">MBX_MODULE_TCP_MASTER_ENABLE</h3>
<p>Default 1</p>
<p>If you need to use the Modbus TCP master functionality, this macro should be set to 1. Otherwise, it is recommended to set it to 0, which will significantly reduce resource usage (mainly RAM).</p>
<h3 id="MBX_MASTER_REQUEST_QUEUE_MAX">MBX_MASTER_REQUEST_QUEUE_MAX</h3>
<p>Default 40</p>
<p>The maximum number of entries in the host request queue for continuous read and write requests, stored and automatically sent for processing. This can significantly affect RAM usage.</p>
<h3 id="MBX_MASTER_MULTI_REG_MAX">MBX_MASTER_MULTI_REG_MAX</h3>
<p>Default 127</p>
<p>The maximum number of multiple registers that the host can read and write to sets the maximum number of registers that can be specified for successive read or write instructions issued by the library, which significantly affects RAM usage.</p>
<h3 id="MBX_EXTEN_REG_HANDLE_ENABLE">MBX_EXTEN_REG_HANDLE_ENABLE</h3>
<p>Default 0</p>
<p>Note that in the examples provided within the library, all different mapped variables require independent and as unique as possible handling functions.</p>
<p>If you need to handle requests from different Modbus virtual addresses in a single handling function, this macro should be set to 1. When this macro is set to 1, the mapping table entries need to be modified (each entry will have an additional parameter set), and each write callback should be rewritten in a new way, which will be detailed later.</p>
<p>A clear applicable scenario is when acting as a Modbus slave, but this slave is merely middleware that needs to control multiple identical module instances. Enabling this macro will greatly reduce the workload and lower maintenance difficulty. There are practical cases for such application scenarios.</p>
<p><strong>The original mapping table</strong> is as follows, where these three addresses control three identical modules:</p>

<pre class="language-c"><code class="language-c">{.Addr = 0x2001, .Memory = &amp;(Powerflag[0]), .Type = MBX_REG_TYPE_U8,    .Handle = ModbusModulePower1,},
{.Addr = 0x2011, .Memory = &amp;(Powerflag[1]), .Type = MBX_REG_TYPE_U8,    .Handle = ModbusModulePower2,}, 
{.Addr = 0x2021, .Memory = &amp;(Powerflag[2]), .Type = MBX_REG_TYPE_U8,    .Handle = ModbusModulePower3,}, 
</code></pre>
<p>You would need to write three almost identical callbacks, similar to the following. Although macros can be used to generate functions and other means, it is still difficult to maintain uniformly.</p>

<pre class="language-c"><code class="language-c">uint32_t ModbusModulePower1(void *value)
{
    uint8_t ValueGet = (*(uint8_t *)value);

    if(ValueGet &gt; 0)
    {
        /* Ignore some startup operations */
        Powerflag[0] = 1;
    }
    else
    {
        /* Ignore some shutdown operations */
        Powerflag[0] = 1;
    }

    return MBX_API_RETURN_DEFAULT;
}
</code></pre>
<p>After enabling this macro, you need to <strong>update this part of the mapping table</strong> as follows:</p>

<pre class="language-c"><code class="language-c">const _MBX_REG_HANDLE_PARA       MBXPara1 = {.Para1 = 1, .Para2 = 1};
const _MBX_REG_HANDLE_PARA       MBXPara2 = {.Para1 = 2, .Para2 = 2};
const _MBX_REG_HANDLE_PARA       MBXPara3 = {.Para1 = 3, .Para2 = 3};
......
{.Addr = 0x2001, .Memory = &amp;(Powerflag[0]), .Type = MBX_REG_TYPE_U8, .Handle = ModbusModulePower, .Para = &amp;MBXPara1},
{.Addr = 0x2011, .Memory = &amp;(Powerflag[1]), .Type = MBX_REG_TYPE_U8, .Handle = ModbusModulePower, .Para = &amp;MBXPara2}, 
{.Addr = 0x2021, .Memory = &amp;(Powerflag[2]), .Type = MBX_REG_TYPE_U8, .Handle = ModbusModulePower, .Para = &amp;MBXPara3}, 
</code></pre>
<p>Here, three global static variables are added as parameter sets, and each mapping entry needs to include the binding of the <code>.Para</code> part. This parameter set will be passed to the write handling function, allowing three identical modules to call the same function without needing to define three almost identical handling functions. Therefore, the definition of the handling function needs to be updated as follows:</p>

<pre class="language-c"><code class="language-c">uint32_t ModbusModulePower(void *value, _MBX_REG_HANDLE_PARA *para)
{
    uint8_t ValueGet = (*(uint8_t *)value);

    if(ValueGet &gt; 0)
    {
        /* Perform startup operation for module identified by para-&gt;Para1 */
        Powerflag[para-&gt;Para1 - 1] = 1;
    }
    else
    {
        /* Perform shutdown operation for module identified by para-&gt;Para1 */
        Powerflag[para-&gt;Para1 - 1] = 1;
    }

    return MBX_API_RETURN_DEFAULT;
}
</code></pre>
<p>For entries that do not use this parameter, the best approach is to set <code>.Para = &amp;DefaultPara</code>, where <code>DefaultPara</code> is a static variable generated when the macro is enabled, to avoid wild pointers.</p>

                        
                    </div>
                </div>
                <div id="previous_next">
                    <div id="previous">
                        
                        <a href="/modbusX/en/apidoc/apimaster/Master2Slave.html">
                            <span class="icon"></span>
                            <span class="label">Initiating requests to slave</span>
                        </a>
                        
                    </div>
                    <div id="next">
                        
                        <a href="/modbusX/en/apidoc/tools/资源占用测试报告.html">
                            <span class="label">Resource usage test report</span>
                            <span class="icon"></span>
                        </a>
                        
                    </div>
                </div>
                <div id="comments-container"></div>
            </div>
            <div id="toc_wrapper">
                <div id="toc">
                    <div id="toc_content">
                            
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a id="to_top" href="#"></a>
    <div id="doc_footer">
        <div id="footer">
            <div id="footer_top">
                <ul>
<li><a>Links</a><ul><li><a target="_blank" href="https://teedoc.neucrack.com">Build with teedoc</a></li>
<li><a  href="/sitemap.xml">Sitemap</a></li>
</ul>
</li>
<li><a>Source code</a><ul><li><a target="_blank" href="https://github.com/stbanana">github</a></li>
<li><a target="_blank" href="https://github.com/stbanana/doc-wiki">website source files</a></li>
</ul>
</li>
</ul>

            </div>
            <div id="footer_bottom">
                <ul>
<li><a target="_blank" href="https://beian.miit.gov.cn"></a></li>
</ul>

            </div>
        </div>
    </div>
    
        <script src="/teedoc-plugin-markdown-parser/mermaid.min.js"></script>
    
        <script>mermaid.initialize({startOnLoad:true});</script>
    
        <script src="/static/js/theme_default/tocbot.min.js"></script>
    
        <script src="/static/js/theme_default/main.js"></script>
    
        <script src="/static/js/theme_default/viewer.min.js"></script>
    
        <script src="/static/css/theme_default/prism.min.js"></script>
    
        <script src="/static/js/search/search_main.js"></script>
    
        <script src="/static/js/custom.js"></script>
    
        <script src="/static/js/gitalk/gitalk.min.js"></script>
    
        <script src="/static/js/gitalk/main.js"></script>
    
</body>

</html>