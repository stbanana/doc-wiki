---
update:
  - date: 2025-04-22
    author: yono
    version: 0.1.0
    content: 定义整体文档结构
update_open: true
---

# 整体协议结构

完全的简单应用层协议，以适应不同传输层接口。本协议不涉及验证和加密，应由更上层完成。

> [!NOTE]
>
> 整个文档中涉及的数字均为 16 进制，不再添加 0x 或 h 指示。

## 整体单帧结构

| 事务号(2字节) | CMD(2字节) | 拓展信息(2字节) | 长度信息(大端2字节) | 消息(x字节) | 和校验(小端2字节) |
| ------------- | ---------- | --------------- | ------------------- | ----------- | ----------------- |

- 事务号：第一字节是累计的事务号(1~FF)，第二字节是其反码
- CMD：指示了应该使用哪个解析系统，对消息第 1 次分流
- 拓展信息：对 CMD 信息的拓展补充，可用于第 2 次解析分流，也可用于补充解析所需信息
- 长度信息：指示**消息**及**和校验**的总长。
- 消息：事实上需要处理的可变长消息
- 和校验：此前所有段的字节和，用于简单校验

事务号0专用于主动上报

## 通用回复表达

大部分请求不需要回复有效信息，仅需回复接收到了指令且执行成功，所以有通用的回复表达为。

| 事务号(2字节) | CMD(2字节) | 拓展信息(2字节) | 长度信息(大端2字节) | 消息(2字节)  | 和校验(小端2字节) |
| ------------- | ---------- | --------------- | ------------------- | ------------ | ----------------- |
| 复制请求      | 复制请求   | 复制请求        | 00 04               | 见下方信息表 | 计算得到          |

消息为

- 00 00：成功执行
- 00 01：通用失败执行
- 00 10：当前状态忙，无法执行
- 00 11：当前状态禁止执行

## 整体的通信方式

![ ](https://cloudflare-imgbed-6qt.pages.dev/file/1745822435960__RH[4X[OK0E6C5UIOV540MF.png)
